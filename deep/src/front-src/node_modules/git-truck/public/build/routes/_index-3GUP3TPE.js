import{a as Z,b as ee,c as re,d as te,e as ae,f as _,g as se,h as H}from"/build/_shared/chunk-ZAZE3T6E.js";import{A as q,Ba as C,E as F,Y as W,b as Y,e as z,ma as G,q as $,va as T}from"/build/_shared/chunk-E4ZX32OJ.js";import{a as J,h as N,j as A,m as D,o as L,p as E,u as U}from"/build/_shared/chunk-ND5WRITB.js";import{b as j,d as p}from"/build/_shared/chunk-G5WX4PPA.js";var O=j(($e,I)=>{I.exports={}});var le=p(ee());var fe=p(re());var ce=p(te());var k=p(J());var M="/build/_assets/truck-JLDVJULS.png";var P={},B=!1;function ie(){if(B)return P;B=!0;var o=Z;function u(f){if(typeof f!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function y(f,e){for(var r="",t=0,s=-1,i=0,a,l=0;l<=f.length;++l){if(l<f.length)a=f.charCodeAt(l);else{if(a===47)break;a=47}if(a===47){if(!(s===l-1||i===1))if(s!==l-1&&i===2){if(r.length<2||t!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){c===-1?(r="",t=0):(r=r.slice(0,c),t=r.length-1-r.lastIndexOf("/")),s=l,i=0;continue}}else if(r.length===2||r.length===1){r="",t=0,s=l,i=0;continue}}e&&(r.length>0?r+="/..":r="..",t=2)}else r.length>0?r+="/"+f.slice(s+1,l):r=f.slice(s+1,l),t=l-s-1;s=l,i=0}else a===46&&i!==-1?++i:i=-1}return r}function b(f,e){var r=e.dir||e.root,t=e.base||(e.name||"")+(e.ext||"");return r?r===e.root?r+t:r+f+t:t}var g={resolve:function(){for(var e="",r=!1,t,s=arguments.length-1;s>=-1&&!r;s--){var i;s>=0?i=arguments[s]:(t===void 0&&(t=o.cwd()),i=t),u(i),i.length!==0&&(e=i+"/"+e,r=i.charCodeAt(0)===47)}return e=y(e,!r),r?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(u(e),e.length===0)return".";var r=e.charCodeAt(0)===47,t=e.charCodeAt(e.length-1)===47;return e=y(e,!r),e.length===0&&!r&&(e="."),e.length>0&&t&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return u(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,r=0;r<arguments.length;++r){var t=arguments[r];u(t),t.length>0&&(e===void 0?e=t:e+="/"+t)}return e===void 0?".":g.normalize(e)},relative:function(e,r){if(u(e),u(r),e===r||(e=g.resolve(e),r=g.resolve(r),e===r))return"";for(var t=1;t<e.length&&e.charCodeAt(t)===47;++t);for(var s=e.length,i=s-t,a=1;a<r.length&&r.charCodeAt(a)===47;++a);for(var l=r.length,c=l-a,h=i<c?i:c,v=-1,m=0;m<=h;++m){if(m===h){if(c>h){if(r.charCodeAt(a+m)===47)return r.slice(a+m+1);if(m===0)return r.slice(a+m)}else i>h&&(e.charCodeAt(t+m)===47?v=m:m===0&&(v=0));break}var S=e.charCodeAt(t+m),X=r.charCodeAt(a+m);if(S!==X)break;S===47&&(v=m)}var x="";for(m=t+v+1;m<=s;++m)(m===s||e.charCodeAt(m)===47)&&(x.length===0?x+="..":x+="/..");return x.length>0?x+r.slice(a+v):(a+=v,r.charCodeAt(a)===47&&++a,r.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(u(e),e.length===0)return".";for(var r=e.charCodeAt(0),t=r===47,s=-1,i=!0,a=e.length-1;a>=1;--a)if(r=e.charCodeAt(a),r===47){if(!i){s=a;break}}else i=!1;return s===-1?t?"/":".":t&&s===1?"//":e.slice(0,s)},basename:function(e,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');u(e);var t=0,s=-1,i=!0,a;if(r!==void 0&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var l=r.length-1,c=-1;for(a=e.length-1;a>=0;--a){var h=e.charCodeAt(a);if(h===47){if(!i){t=a+1;break}}else c===-1&&(i=!1,c=a+1),l>=0&&(h===r.charCodeAt(l)?--l===-1&&(s=a):(l=-1,s=c))}return t===s?s=c:s===-1&&(s=e.length),e.slice(t,s)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!i){t=a+1;break}}else s===-1&&(i=!1,s=a+1);return s===-1?"":e.slice(t,s)}},extname:function(e){u(e);for(var r=-1,t=0,s=-1,i=!0,a=0,l=e.length-1;l>=0;--l){var c=e.charCodeAt(l);if(c===47){if(!i){t=l+1;break}continue}s===-1&&(i=!1,s=l+1),c===46?r===-1?r=l:a!==1&&(a=1):r!==-1&&(a=-1)}return r===-1||s===-1||a===0||a===1&&r===s-1&&r===t+1?"":e.slice(r,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return b("/",e)},parse:function(e){u(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return r;var t=e.charCodeAt(0),s=t===47,i;s?(r.root="/",i=1):i=0;for(var a=-1,l=0,c=-1,h=!0,v=e.length-1,m=0;v>=i;--v){if(t=e.charCodeAt(v),t===47){if(!h){l=v+1;break}continue}c===-1&&(h=!1,c=v+1),t===46?a===-1?a=v:m!==1&&(m=1):a!==-1&&(m=-1)}return a===-1||c===-1||m===0||m===1&&a===c-1&&a===l+1?c!==-1&&(l===0&&s?r.base=r.name=e.slice(1,c):r.base=r.name=e.slice(l,c)):(l===0&&s?(r.name=e.slice(1,a),r.base=e.slice(1,c)):(r.name=e.slice(l,a),r.base=e.slice(l,c)),r.ext=e.slice(a,c)),l>0?r.dir=e.slice(0,l-1):s&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};return g.posix=g,P=g,P}var d=ie();var be=d._makeLong,we=d.basename,ke=d.delimiter,xe=d.dirname,Ae=d.extname,Ne=d.format,Ce=d.isAbsolute,R=d.join,Pe=d.normalize,Re=d.parse,Se=d.posix,De=d.relative,oe=d.resolve,Le=d.sep,Ee=d.win32;var K=p(ae()),w=p(Y());var me=p(se());var ue=p(O()),n=p(U());function Q(){var e,r;let{repositories:o,baseDir:u,analyzedReposPromise:y,...b}=L(),g=b,f=E();return(0,n.jsxs)("main",{className:"m-auto flex min-h-screen w-full max-w-2xl flex-col gap-2 p-2",children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("h1",{className:"flex items-center text-4xl",children:[(0,n.jsx)("img",{src:M,alt:"Git Truck",className:"mr-2 inline-block h-12"}),"Git Truck"]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsxs)("p",{children:["Found ",o.length," folder",o.length===1?"":"s"]}),(0,n.jsxs)(N,{className:"w-4",method:"post",action:"/clearCache",children:[(0,n.jsx)("input",{type:"hidden",name:"clearCache",value:"true"}),(0,n.jsxs)("button",{className:"btn",title:"Do this if you are experiencing issues",children:[(0,n.jsx)(w.default,{path:$,className:"hover-swap inline-block h-full"}),"Clear analyzed results"]})]}),(0,n.jsxs)("div",{className:"hidden w-full gap-2",children:[(0,n.jsxs)(N,{method:"get",className:"flex grow gap-1",children:[!((e=f.data)!=null&&e.ok)&&((r=f.data)!=null&&r.message)?(0,n.jsx)("p",{className:"text-red-500",children:f.data.message}):null,(0,n.jsx)("input",{className:"input",name:"path",defaultValue:u,required:!0,onKeyUp:t=>{var s;t.key==="Enter"&&(t.preventDefault(),(s=t.currentTarget.form)==null||s.submit())}},u),(0,n.jsx)("button",{className:"btn btn--primary",children:"Browse"})]}),(0,n.jsx)(A,{className:"btn btn--primary",to:`/?${new URLSearchParams({path:u}).toString()}`,prefetch:"intent",children:(0,n.jsx)(w.default,{path:z,size:1,className:"inline-block"})})]})]})]}),o.length>0?(0,n.jsxs)(de,{children:[(0,n.jsx)("div",{className:"opacity-80",children:"Folder"}),(0,n.jsx)("div",{className:"opacity-80",children:"Status"}),(0,n.jsx)("div",{className:"col-span-2 opacity-80",children:"Actions"}),o.map((t,s)=>(0,n.jsx)(k.Suspense,{fallback:(0,n.jsx)(V,{repo:{name:t,path:t,fullPath:R(u,t),parentDirPath:u,status:"Loading"},analyzedRepos:[]}),children:(0,n.jsx)(D,{resolve:Promise.all([g[`_${t}`],y]),children:([i,a])=>i!==null?(0,n.jsx)(V,{repo:i,analyzedRepos:a},i.name):null})},o[s]))]}):(0,n.jsx)("div",{className:"card w-full place-items-center",children:(0,n.jsx)(H,{loadingText:"This looks empty... Try another folder",hideInitially:!1})})]})}function de({children:o}){return o.length===0?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("p",{children:["Try running ",(0,n.jsx)(T,{inline:!0,children:"git-truck"})," in another folder or provide another path as argument."]})}):(0,n.jsx)("div",{className:"card row-start-auto grid w-full grid-flow-row grid-cols-[1fr,1fr,1fr,auto] flex-wrap items-center gap-2",children:o})}function V({repo:o,analyzedRepos:u}){var s;let y=o.status==="Success",b=o.status==="Error",[g,f]=(0,k.useState)(y?o.currentHead:null),e=g?G(o.name,g):null,r=o.status==="Error"&&o.errorMessage==="Not a git repository",t=u.find(i=>i.repo===o.name&&i.branch===g);return(0,n.jsxs)(k.Fragment,{children:[(0,n.jsxs)("h2",{className:"card__title flex justify-start gap-2",title:R(o.parentDirPath,o.name),children:[b?r?(0,n.jsx)(w.default,{path:q,size:1,className:"inline-block flex-shrink-0",title:"Folder"}):(0,n.jsx)(w.default,{path:W,size:1,className:"inline-block flex-shrink-0",title:"Error"}):(0,n.jsx)(w.default,{path:F,size:1,className:"inline-block flex-shrink-0",title:"Git repository"}),(0,n.jsx)("span",{className:"truncate text-left",children:o.name})]}),(0,n.jsxs)("div",{className:"flex place-items-center gap-1",children:[r?(0,n.jsx)("div",{}):(0,n.jsx)("div",{className:C("aspect-square h-2 rounded-full",{"bg-gradient-to-bl from-green-500 to-green-600":o.status==="Success"&&t,"bg-gradient-to-bl from-red-500 to-red-600":o.status==="Error","animate-pulse bg-gradient-to-bl from-yellow-500 to-yellow-600":o.status==="Loading","bg-gradient-to-bl from-gray-500 to-gray-400":o.status==="Success"&&!t})}),r?(0,n.jsx)("div",{className:"grow"}):(0,n.jsx)("span",{"data-testid":`status-${o.name}`,className:C("w-full min-w-max select-none rounded-full bg-transparent px-2 py-1.5 text-xs font-bold uppercase leading-none tracking-widest text-inherit transition-colors duration-200"),children:o.status==="Success"?t?"Analyzed":"Not analyzed":o.status})]}),(0,n.jsx)("div",{className:"flex place-items-center gap-1",children:y?(0,n.jsx)(_,{className:"input--hover-border","data-testid":`revision-select-${o.name}`,value:g!=null?g:"",onChange:i=>f(i.target.value),headGroups:o.refs,analyzedBranches:u.filter(i=>i.repo===o.name)}):b&&!r?(0,n.jsx)("div",{className:"grow truncate",title:o.errorMessage,children:(s=o.errorMessage)!=null?s:"Unknown error"}):(0,n.jsx)("div",{className:"grow"})}),r?(0,n.jsx)(A,{className:"btn btn--primary",to:`/?${new URLSearchParams({path:o.path}).toString()}`,prefetch:"none",children:"Browse"}):(0,n.jsx)(A,{className:"btn btn--primary btn--outlined transition-colors",title:`View ${o.name}`,"aria-disabled":o.status==="Error"||o.status==="Loading",to:e!=null?e:"",prefetch:"none",children:"View"}),(0,n.jsx)("hr",{className:"col-span-full last:hidden"})]},o.name)}export{Q as default};
